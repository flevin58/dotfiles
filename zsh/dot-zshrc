#
# This file will be linked to ~/.zshrc
#

export PROJECTS=$HOME/Projects
export DOTFILES=$HOME/.dotfiles
export EDITOR=nvim

# Homebrew
eval "$(/opt/homebrew/bin/brew shellenv)"
BREW_PREFIX=$(brew --prefix)

# Lazy-load antidote and generate the static load file only when needed
zsh_plugins=$HOME/.plugins
if [[ ! ${zsh_plugins}.zsh -nt ${zsh_plugins}.txt ]]; then
  (
    source $BREW_PREFIX/opt/antidote/share/antidote/antidote.zsh
    antidote bundle <${zsh_plugins}.txt >${zsh_plugins}.zsh
  )
fi
source ${zsh_plugins}.zsh

# Set key bindings to zsh
bindkey -v
bindkey '^[[A' history-substring-search-up # or '\eOA'
bindkey '^[[B' history-substring-search-down # or '\eOB'
HISTORY_SUBSTRING_SEARCH_ENSURE_UNIQUE=1

# Set history related stuff
HISTSIZE=5000
HISTFILE=${HOME}/.zsh_history
SAVEHIST=$HISTSIZE
HISTDUP=erase
setopt appendhistory
setopt sharehistory
setopt hist_ignore_space
setopt hist_ignore_all_dups
setopt hist_save_no_dups
setopt hist_ignore_dups
setopt hist_find_no_dups

# Do the magic and source any .zsh file in local/zsh !!!
for zshfile in ${DOTFILES}/local/zsh/*.zsh; do
  source $zshfile;
done

# Add FuzzyFind integration
eval "$(fzf --zsh)"

# Add oh-my-posh command prompt
if [ "$TERM_PROGRAM" != "Apple_Terminal" ]; then
  eval "$(oh-my-posh init zsh --config ${DOTFILES}/local/omp/config.toml)"
fi

# Add zoxide functionality
eval "$(zoxide init zsh)"
alias cd="z"

# Kool computer info on screen
neofetch
